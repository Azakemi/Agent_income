<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Agent Income Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --accent-dark: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #8e9eab, #eef2f3);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            line-height: 1.6;
            background-size: cover;
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            overflow: hidden;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--glass-shadow);
            border-left: 4px solid var(--accent);
        }

        .header {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.9));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.2));
            z-index: 0;
        }

        .logo {
            position: absolute;
            top: 20px;
            left: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.2rem;
            z-index: 1;
        }

        .logo i {
            font-size: 1.8rem;
            color: #3498db;
        }

        .header h1 {
            font-size: 2.5rem;
            margin: 15px 0 10px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 30px;
        }

        .section-title {
            margin-bottom: 25px;
            color: var(--primary);
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: var(--accent);
            font-size: 1.5rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .input-group label i {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .input-group input {
            padding: 15px;
            border: 2px solid rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            font-size: 1.1rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            color: #333;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.15);
            background: rgba(255, 255, 255, 0.3);
        }

        .btn-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3));
            z-index: -1;
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .btn:hover::before {
            transform: translateX(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #219653);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .results-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .chart-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            position: relative;
            height: 380px;
            display: flex;
            flex-direction: column;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-wrapper {
            flex: 1;
            position: relative;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.9));
            color: white;
            padding: 25px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--glass-shadow);
            transition: var(--transition);
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1));
            transform: rotate(45deg);
            z-index: 0;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .summary-card h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            opacity: 0.9;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }

        .commission-structure {
            background: rgba(248, 249, 250, 0.2);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            border-left: 4px solid var(--success);
        }

        .commission-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .commission-table th,
        .commission-table td {
            padding: 14px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .commission-table th {
            background: rgba(44, 62, 80, 0.9);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .commission-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.1);
        }

        .commission-table tr:hover {
            background: rgba(233, 236, 239, 0.3);
        }

        .detailed-breakdown {
            background: var(--glass-bg);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 25px;
            margin-top: 30px;
            box-shadow: var(--glass-shadow);
            overflow-x: auto;
            border-left: 4px solid var(--warning);
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            min-width: 700px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .breakdown-table th,
        .breakdown-table td {
            padding: 14px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .breakdown-table th {
            background: rgba(44, 62, 80, 0.9);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .breakdown-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.1);
        }

        .breakdown-table tr:hover {
            background: rgba(233, 236, 239, 0.3);
        }

        .info-box {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.8), rgba(41, 128, 185, 0.9));
            color: white;
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(5px);
        }

        .info-box h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-box p {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .info-box strong {
            font-weight: 600;
            font-size: 1.15rem;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(243, 243, 243, 0.3);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .agent-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(240, 247, 255, 0.3);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
        }

        .agent-detail {
            display: flex;
            flex-direction: column;
        }

        .agent-detail span:first-child {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agent-detail span:last-child {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 8px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: var(--primary);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 15px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 1rem;
            font-weight: normal;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .profile-report {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.9), rgba(52, 73, 94, 0.95));
            color: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-top: 40px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(5px);
            border: 1px solid var(--glass-border);
        }

        .report-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .report-header h2 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .report-header p {
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .report-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
        }

        .report-card h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-card h3 i {
            font-size: 1.6rem;
        }

        .growth-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-row .label {
            font-weight: 500;
            opacity: 0.9;
        }

        .stat-row .value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .growth-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #27ae60;
            font-weight: 600;
        }

        .report-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: rgba(240, 240, 240, 0.3);
            border: 3px solid var(--accent);
            overflow: hidden;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .photo-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3));
            z-index: 0;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: relative;
            z-index: 1;
        }

        .photo-preview i {
            font-size: 3rem;
            color: #ccc;
            position: relative;
            z-index: 1;
        }

        .photo-upload label {
            background: var(--accent);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: inline-block;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .photo-upload label::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3));
            z-index: -1;
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .photo-upload label:hover::before {
            transform: translateX(0);
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        /* Agent Photo in Report */
        .agent-profile-header {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .agent-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--accent);
            overflow: hidden;
            position: relative;
        }

        .agent-photo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3));
            z-index: 1;
        }

        .agent-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: relative;
            z-index: 2;
        }

        .agent-details {
            flex: 1;
        }

        .agent-details h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .agent-details p {
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        /* Filters Section */
        .filters {
            background: rgba(248, 249, 250, 0.3);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            border: 1px solid var(--glass-border);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .filter-group select, 
        .filter-group input {
            padding: 12px;
            border: 2px solid rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            color: #333;
        }
        
        /* Additional Infographics */
        .infographic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .infographic-card {
            background: var(--glass-bg);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--glass-shadow);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .infographic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1));
            z-index: 0;
        }
        
        .infographic-card i {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .infographic-card h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--primary);
            position: relative;
            z-index: 1;
        }
        
        .infographic-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
            position: relative;
            z-index: 1;
        }
        
        .infographic-card .subtitle {
            font-size: 1rem;
            color: #777;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }
        
        /* Report Actions */
        .report-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
        }
        
        /* Milestone Section */
        .milestone-section {
            margin-top: 40px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .milestone-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(5px);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-left: 4px solid var(--accent);
        }
        
        .milestone-card::before {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0.2;
        }
        
        .milestone-card h4 {
            font-size: 1.3rem;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .milestone-card .value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
        }
        
        .milestone-card .year {
            font-size: 1.1rem;
            color: #ccc;
            margin-bottom: 15px;
        }
        
        .milestone-card .detail {
            font-size: 1rem;
            color: #ddd;
            margin-top: 10px;
        }
        
        .milestone-card .highlight {
            color: var(--warning);
            font-weight: 600;
        }
        
        .milestone-flag {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--warning);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            transform: rotate(5deg);
            z-index: 1;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .header h1 {
                font-size: 2.2rem;
                padding-top: 15px;
            }
            
            .input-grid {
                gap: 20px;
            }
            
            .section-title {
                font-size: 1.6rem;
            }
            
            .chart-container {
                height: 340px;
            }
            
            .report-charts {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
                margin-top: 30px;
            }
            
            .logo {
                top: 15px;
                left: 20px;
                font-size: 1rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .glass-card {
                padding: 25px;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .results-section {
                grid-template-columns: 1fr;
            }
            
            .summary-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .chart-container {
                padding: 20px;
                height: 320px;
            }
            
            .btn-container {
                flex-direction: column;
                gap: 12px;
            }
            
            canvas {
                max-width: 100% !important;
            }
            
            .report-grid {
                grid-template-columns: 1fr;
            }
            
            .agent-profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .report-actions {
                flex-direction: column;
            }
            
            .milestone-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .header h1 {
                font-size: 1.6rem;
            }
            
            .section-title {
                font-size: 1.4rem;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .agent-info {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 280px;
            }
            
            .btn {
                padding: 14px;
                font-size: 1rem;
                width: 100%;
            }
            
            .report-header h2 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <span>LifeSecure Insurance</span>
            </div>
            <h1>Professional Agent Income Calculator</h1>
            <p>Advanced commission calculation and income projection for insurance professionals by Surajit Chatterjee</p>
        </div>

        <div class="main-content">
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> Term Insurance Coverage Details</h3>
                <p><strong>Amount Payable at Death (Before Age 60): ₹12,00,000</strong></p>
                <p>Calculate your commission income based on premium collection and number of policies sold</p>
            </div>

            <div class="glass-card">
                <h2 class="section-title"><i class="fas fa-user-tie"></i> Agent Information</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="agentName"><i class="fas fa-user"></i> Full Name</label>
                        <input type="text" id="agentName" placeholder="Enter your full name" value="Surajit Chatterjee">
                    </div>
                    <div class="input-group">
                        <label for="age"><i class="fas fa-birthday-cake"></i> Age</label>
                        <input type="number" id="age" placeholder="Enter your age" min="18" max="100" value="59">
                    </div>
                    <div class="input-group">
                        <label for="contact"><i class="fas fa-phone"></i> Contact Number</label>
                        <input type="tel" id="contact" placeholder="Enter contact number" value="9431330186+">
                    </div>
                    <div class="input-group">
                        <label for="agentId"><i class="fas fa-id-badge"></i> Agent ID</label>
                        <input type="text" id="agentId" placeholder="Enter your agent ID" value="332962">
                    </div>
                </div>
                
                <div class="photo-upload">
                    <div class="photo-preview" id="photoPreview">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <label for="photoUpload">
                        <i class="fas fa-upload"></i> Upload Profile Photo
                    </label>
                    <input type="file" id="photoUpload" accept="image/*">
                </div>
            </div>

            <div class="glass-card">
                <h2 class="section-title"><i class="fas fa-calculator"></i> Calculation Parameters</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="premium"><i class="fas fa-rupee-sign"></i> Annual Premium per Policy (₹)</label>
                        <input type="number" id="premium" placeholder="Enter premium amount" min="1000" step="100" value="20000">
                    </div>
                    <div class="input-group">
                        <label for="lives"><i class="fas fa-users"></i> Number of Policies</label>
                        <input type="number" id="lives" placeholder="Enter number of policies" min="1" step="1" value="15">
                    </div>
                    <div class="input-group">
                        <label for="years"><i class="fas fa-calendar-alt"></i> Projection Years</label>
                        <input type="number" id="years" placeholder="Enter projection years" min="1" max="30" step="1" value="10">
                    </div>
                </div>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="premiumGrowth"><i class="fas fa-chart-line"></i> Premium Growth (% per year)</label>
                        <input type="number" id="premiumGrowth" placeholder="Enter premium growth" min="0" max="100" step="0.5" value="10">
                    </div>
                    <div class="input-group">
                        <label for="policyGrowth"><i class="fas fa-users"></i> Policy Growth (% per year)</label>
                        <input type="number" id="policyGrowth" placeholder="Enter policy growth" min="0" max="100" step="0.5" value="10">
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-primary" onclick="calculateIncome()">
                        <i class="fas fa-calculator"></i> Calculate Income Projection
                    </button>
                    <button class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-redo"></i> Reset Form
                    </button>
                </div>
            </div>

            <div class="commission-structure">
                <h2 class="section-title"><i class="fas fa-percent"></i> Commission Structure</h2>
                <div class="tooltip">
                    <i class="fas fa-info-circle"></i> Commission Policy Details
                    <span class="tooltiptext">
                        Our commission structure is designed to reward agents for both new policy acquisition and ongoing client relationships. 
                        First year commissions are higher to compensate for acquisition costs, while renewal commissions provide ongoing income.
                    </span>
                </div>
                <table class="commission-table">
                    <thead>
                        <tr>
                            <th>Policy Year</th>
                            <th>Commission Rate</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1st Year</td><td>28%</td><td>First year premium commission</td></tr>
                        <tr><td>2nd Year</td><td>7.5%</td><td>Renewal commission</td></tr>
                        <tr><td>3rd Year</td><td>7.5%</td><td>Renewal commission</td></tr>
                        <tr><td>4th Year</td><td>7.5%</td><td>Renewal commission</td></tr>
                        <tr><td>5th Year</td><td>5%</td><td>Renewal commission</td></tr>
                        <tr><td>6th Year</td><td>7.5%</td><td>Renewal commission</td></tr>
                        <tr><td>7th Year</td><td>7.5%</td><td>Renewal commission</td></tr>
                        <tr><td>8th+ Years</td><td>5%</td><td>Ongoing renewal commission</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Generating your professional income projection...</p>
            </div>

            <div id="results" style="display: none;">
                <div class="filters">
                    <div class="filter-group">
                        <label for="yearFilter"><i class="fas fa-filter"></i> Filter by Year</label>
                        <select id="yearFilter" onchange="filterResults()">
                            <option value="all">All Years</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="incomeFilter"><i class="fas fa-money-bill-wave"></i> Filter by Income</label>
                        <select id="incomeFilter" onchange="filterResults()">
                            <option value="all">All Income</option>
                            <option value="high">High Income (>₹5L)</option>
                            <option value="medium">Medium Income (₹2L-₹5L)</option>
                            <option value="low">Low Income (<₹2L)</option>
                        </select>
                    </div>
                </div>
                
                <div class="agent-info">
                    <div class="agent-detail">
                        <span><i class="fas fa-user"></i> Agent Name</span>
                        <span id="resultName">-</span>
                    </div>
                    <div class="agent-detail">
                        <span><i class="fas fa-id-badge"></i> Agent ID</span>
                        <span id="resultId">-</span>
                    </div>
                    <div class="agent-detail">
                        <span><i class="fas fa-calendar"></i> Projection Period</span>
                        <span id="resultPeriod">-</span>
                    </div>
                    <div class="agent-detail">
                        <span><i class="fas fa-file-invoice-dollar"></i> Initial Premium</span>
                        <span id="resultPremium">-</span>
                    </div>
                </div>
                
                <h2 class="section-title"><i class="fas fa-chart-line"></i> Income Summary</h2>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Total Projected Income</h3>
                        <div class="value" id="totalIncome">₹0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Average Annual Income</h3>
                        <div class="value" id="avgAnnual">₹0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Peak Year Income</h3>
                        <div class="value" id="peakIncome">₹0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Total Policies Sold</h3>
                        <div class="value" id="totalLives">0</div>
                    </div>
                </div>
                
                <div class="infographic-grid">
                    <div class="infographic-card">
                        <i class="fas fa-chart-line"></i>
                        <h4>Policies at Peak Year</h4>
                        <div class="value" id="peakPolicies">0</div>
                        <div class="subtitle">Highest earning year</div>
                    </div>
                    <div class="infographic-card">
                        <i class="fas fa-bullseye"></i>
                        <h4>To Next ₹1 Crore</h4>
                        <div class="value" id="nextCrorePolicies">0</div>
                        <div class="subtitle">Additional policies needed</div>
                    </div>
                    <div class="infographic-card">
                        <i class="fas fa-trophy"></i>
                        <h4>Milestones Achieved</h4>
                        <div class="value" id="milestoneCount">0</div>
                        <div class="subtitle">Income milestones reached</div>
                    </div>
                    <div class="infographic-card">
                        <i class="fas fa-hand-holding-usd"></i>
                        <h4>Total Premium Managed</h4>
                        <div class="value" id="totalPremium">₹0</div>
                        <div class="subtitle">Total value of policies</div>
                    </div>
                </div>

                <div class="results-section">
                    <div class="chart-container">
                        <h3 class="chart-title">Annual Income Progression</h3>
                        <div class="chart-wrapper">
                            <canvas id="incomeChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Cumulative Income Growth</h3>
                        <div class="chart-wrapper">
                            <canvas id="cumulativeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="detailed-breakdown">
                    <h2 class="section-title"><i class="fas fa-table"></i> Year-wise Income Breakdown</h2>
                    <table class="breakdown-table">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Policies Sold</th>
                                <th>Premium per Policy</th>
                                <th>Total Premium</th>
                                <th>Annual Income (₹)</th>
                                <th>Cumulative Income (₹)</th>
                            </tr>
                        </thead>
                        <tbody id="breakdownBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="profile-report" id="profileReport">
                    <div class="report-header">
                        <h2>Professional Agent Profile Report</h2>
                        <p>Comprehensive income projection and growth analysis for insurance professionals</p>
                    </div>
                    
                    <div class="agent-profile-header">
                        <div class="agent-photo" id="reportPhoto">
                            <img id="agentPhotoImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 24 24' fill='%23cccccc'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Agent Photo">
                        </div>
                        <div class="agent-details">
                            <h3 id="reportAgentName">Rajesh Kumar</h3>
                            <p><strong>Agent ID:</strong> <span id="reportAgentId">INS-2023-007</span></p>
                            <p><strong>Age:</strong> <span id="reportAgentAge">35</span> years</p>
                            <p><strong>Contact:</strong> <span id="reportAgentContact">9876543210</span></p>
                        </div>
                    </div>
                    
                    <div class="report-grid">
                        <div class="report-card">
                            <h3><i class="fas fa-user-tie"></i> Agent Profile</h3>
                            <div class="stat-row">
                                <span class="label">Years of Projection:</span>
                                <span class="value" id="reportPeriod">10 Years</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Initial Premium:</span>
                                <span class="value" id="reportInitialPremium">₹20,000</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Initial Policies:</span>
                                <span class="value" id="reportInitialPolicies">15</span>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <h3><i class="fas fa-money-bill-wave"></i> Financial Summary</h3>
                            <div class="stat-row">
                                <span class="label">Total Projected Income:</span>
                                <span class="value" id="reportTotalIncome">₹0</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Average Annual Income:</span>
                                <span class="value" id="reportAvgIncome">₹0</span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Peak Year Income:</span>
                                <span class="value" id="reportPeakIncome">₹0</span>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <h3><i class="fas fa-chart-line"></i> Growth Projection</h3>
                            <div class="stat-row">
                                <span class="label">Premium Growth:</span>
                                <span class="value" id="reportPremiumGrowth">10% <i class="fas fa-arrow-up growth-indicator"></i></span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Policy Growth:</span>
                                <span class="value" id="reportPolicyGrowth">10% <i class="fas fa-arrow-up growth-indicator"></i></span>
                            </div>
                            <div class="stat-row">
                                <span class="label">Income Growth:</span>
                                <span class="value" id="incomeGrowth">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-charts">
                        <div class="chart-container">
                            <h3 class="chart-title">Premium Growth Projection</h3>
                            <div class="chart-wrapper">
                                <canvas id="premiumGrowthChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h3 class="chart-title">Policy Growth Projection</h3>
                            <div class="chart-wrapper">
                                <canvas id="policyGrowthChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="infographic-grid">
                        <div class="infographic-card">
                            <i class="fas fa-chart-line"></i>
                            <h4>Policies at Peak Year</h4>
                            <div class="value" id="reportPeakPolicies">0</div>
                            <div class="subtitle">Highest earning year</div>
                        </div>
                        <div class="infographic-card">
                            <i class="fas fa-bullseye"></i>
                            <h4>To Next ₹1 Crore</h4>
                            <div class="value" id="reportNextCrorePolicies">0</div>
                            <div class="subtitle">Additional policies needed</div>
                        </div>
                        <div class="infographic-card">
                            <i class="fas fa-trophy"></i>
                            <h4>Milestones Achieved</h4>
                            <div class="value" id="reportMilestoneCount">0</div>
                            <div class="subtitle">Income milestones reached</div>
                        </div>
                        <div class="infographic-card">
                            <i class="fas fa-hand-holding-usd"></i>
                            <h4>Total Premium Managed</h4>
                            <div class="value" id="reportTotalPremium">₹0</div>
                            <div class="subtitle">Total value of policies</div>
                        </div>
                    </div>
                    
                    <!-- Milestone Predictions Section -->
                    <div class="milestone-section">
                        <h2 class="section-title"><i class="fas fa-flag"></i> Milestone Predictions</h2>
                        <p class="subtitle">Projected income milestones and achievements</p>
                        <div class="milestone-grid" id="milestoneGrid">
                            <!-- Milestone cards will be populated here -->
                        </div>
                    </div>
                    
                    <div class="report-actions">
                        <button class="btn btn-success" onclick="saveAsPDF()">
                            <i class="fas fa-file-pdf"></i> Save Report as PDF
                        </button>
                        <button class="btn btn-warning" onclick="saveAsImage()">
                            <i class="fas fa-image"></i> Save Report as Image
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        let incomeChart = null;
        let cumulativeChart = null;
        let premiumGrowthChart = null;
        let policyGrowthChart = null;
        let currentResults = {};
        let agentPhoto = null;
        let breakdownData = [];

        // Handle photo upload
        document.getElementById('photoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    agentPhoto = event.target.result;
                    document.getElementById('photoPreview').innerHTML = `<img src="${agentPhoto}" alt="Profile Preview">`;
                }
                reader.readAsDataURL(file);
            }
        });

        function getCommissionRate(year) {
            if (year === 1) return 0.28;
            if (year === 2 || year === 3 || year === 4) return 0.075;
            if (year === 5) return 0.05;
            if (year === 6 || year === 7) return 0.075;
            return 0.05; // 8th year onwards
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            }).format(amount);
        }

        function calculateIncome() {
            const agentName = document.getElementById('agentName').value || 'Not provided';
            const age = document.getElementById('age').value || 'Not provided';
            const contact = document.getElementById('contact').value || 'Not provided';
            const agentId = document.getElementById('agentId').value || 'Not provided';
            const premium = parseFloat(document.getElementById('premium').value);
            const lives = parseInt(document.getElementById('lives').value);
            const years = parseInt(document.getElementById('years').value);
            const premiumGrowth = parseFloat(document.getElementById('premiumGrowth').value) / 100;
            const policyGrowth = parseFloat(document.getElementById('policyGrowth').value) / 100;

            if (!premium || !lives || !years || premium < 1000 || lives < 1 || years < 1) {
                alert('Please enter valid values for all fields');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            // Store agent info
            currentResults.agentName = agentName;
            currentResults.age = age;
            currentResults.contact = contact;
            currentResults.agentId = agentId;
            currentResults.years = years;
            currentResults.premium = premium;
            currentResults.lives = lives;
            currentResults.premiumGrowth = premiumGrowth;
            currentResults.policyGrowth = policyGrowth;

            setTimeout(() => {
                const yearlyIncome = [];
                const cumulativeIncome = [];
                const premiumPerYear = [];
                const policiesPerYear = [];
                const premiumGrowthData = [];
                const policyGrowthData = [];
                const milestones = [];
                const CRORE = 10000000; // 1 crore = 10,000,000 rupees
                
                let totalIncomeSum = 0;
                let totalPremiumSum = 0;
                let totalPolicies = 0;
                let peakIncome = 0;
                let bestYear = 1;
                let peakPolicies = 0;

                // Reset breakdown data
                breakdownData = [];

                // Calculate with custom yearly growth
                for (let year = 1; year <= years; year++) {
                    // Calculate premium and policies for this year with growth
                    const currentPremium = premium * Math.pow(1 + premiumGrowth, year - 1);
                    const currentPolicies = Math.round(lives * Math.pow(1 + policyGrowth, year - 1));
                    
                    premiumPerYear.push(currentPremium);
                    policiesPerYear.push(currentPolicies);
                    premiumGrowthData.push(currentPremium);
                    policyGrowthData.push(currentPolicies);
                    
                    totalPolicies += currentPolicies;
                    
                    let yearIncome = 0;
                    
                    // Calculate commission from all active policies
                    for (let policyYear = 1; policyYear <= year; policyYear++) {
                        const cohortIndex = year - policyYear;
                        if (cohortIndex >= 0) {
                            const cohortPremium = premium * Math.pow(1 + premiumGrowth, cohortIndex);
                            const cohortPolicies = Math.round(lives * Math.pow(1 + policyGrowth, cohortIndex));
                            const commissionRate = getCommissionRate(policyYear);
                            const cohortIncome = cohortPolicies * cohortPremium * commissionRate;
                            
                            yearIncome += cohortIncome;
                            
                            // Add to total premium managed
                            if (policyYear === 1) {
                                totalPremiumSum += cohortPolicies * cohortPremium;
                            }
                        }
                    }
                    
                    yearlyIncome.push(yearIncome);
                    totalIncomeSum += yearIncome;
                    cumulativeIncome.push(totalIncomeSum);
                    
                    // Track peak year
                    if (yearIncome > peakIncome) {
                        peakIncome = yearIncome;
                        bestYear = year;
                        peakPolicies = currentPolicies;
                    }
                    
                    // Check for crore milestones
                    const croreMilestones = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
                    for (const crore of croreMilestones) {
                        const milestoneValue = crore * CRORE;
                        if (totalIncomeSum >= milestoneValue && !milestones.find(m => m.milestoneValue === milestoneValue)) {
                            milestones.push({
                                milestoneValue: milestoneValue,
                                year: year,
                                cumulativeIncome: totalIncomeSum,
                                policies: currentPolicies,
                                totalPremium: currentPolicies * currentPremium,
                                annualIncome: yearIncome
                            });
                        }
                    }
                    
                    // Add to breakdown data
                    breakdownData.push({
                        year: year,
                        policies: policiesPerYear[year-1],
                        premiumPerPolicy: premiumPerYear[year-1],
                        totalPremium: policiesPerYear[year-1] * premiumPerYear[year-1],
                        income: yearIncome,
                        cumulativeIncome: cumulativeIncome[year-1]
                    });
                }

                // Calculate additional policies needed for next crore
                const nextCrore = Math.ceil(totalIncomeSum / CRORE) * CRORE;
                const incomeGap = nextCrore - totalIncomeSum;
                let additionalPolicies = 0;
                
                if (breakdownData.length > 0) {
                    const lastYearData = breakdownData[breakdownData.length-1];
                    const commissionPerPolicy = lastYearData.income / lastYearData.policies;
                    
                    if (commissionPerPolicy > 0) {
                        additionalPolicies = Math.ceil(incomeGap / commissionPerPolicy);
                    }
                }

                // Update summary cards
                document.getElementById('totalIncome').textContent = formatCurrency(totalIncomeSum);
                document.getElementById('avgAnnual').textContent = formatCurrency(totalIncomeSum / years);
                document.getElementById('peakIncome').textContent = formatCurrency(peakIncome);
                document.getElementById('totalLives').textContent = totalPolicies.toLocaleString();
                
                // Update infographics
                document.getElementById('peakPolicies').textContent = peakPolicies.toLocaleString();
                document.getElementById('nextCrorePolicies').textContent = additionalPolicies.toLocaleString();
                document.getElementById('milestoneCount').textContent = milestones.length;
                document.getElementById('totalPremium').textContent = formatCurrency(totalPremiumSum);
                
                // Update agent info
                document.getElementById('resultName').textContent = agentName;
                document.getElementById('resultId').textContent = agentId;
                document.getElementById('resultPeriod').textContent = `${years} Years`;
                document.getElementById('resultPremium').textContent = formatCurrency(premium);
                
                // Create charts
                createCharts(yearlyIncome, cumulativeIncome, years);
                createGrowthCharts(premiumGrowthData, policyGrowthData, years);
                
                // Create detailed breakdown
                createBreakdown();
                
                // Update profile report
                updateProfileReport(totalIncomeSum, totalPolicies, yearlyIncome, agentPhoto, 
                                   peakPolicies, additionalPolicies, milestones.length, 
                                   totalPremiumSum, milestones);

                // Populate year filter
                populateYearFilter(years);

                // Store results
                currentResults.yearlyIncome = yearlyIncome;
                currentResults.cumulativeIncome = cumulativeIncome;
                currentResults.totalIncomeSum = totalIncomeSum;
                currentResults.avgAnnual = totalIncomeSum / years;
                currentResults.peakIncome = peakIncome;
                currentResults.totalLives = totalPolicies;
                currentResults.totalPremium = totalPremiumSum;
                currentResults.premiumPerYear = premiumPerYear;
                currentResults.policiesPerYear = policiesPerYear;
                currentResults.bestYear = bestYear;
                currentResults.peakPolicies = peakPolicies;
                currentResults.additionalPolicies = additionalPolicies;
                currentResults.milestones = milestones;

                // Hide loading and show results
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                
                // Scroll to results
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 1000);
        }

        function createCharts(yearlyIncome, cumulativeIncome, years) {
            const years_labels = Array.from({length: years}, (_, i) => `Year ${i + 1}`);

            // Destroy existing charts
            if (incomeChart) incomeChart.destroy();
            if (cumulativeChart) cumulativeChart.destroy();

            // Annual Income Chart
            const ctx1 = document.getElementById('incomeChart').getContext('2d');
            incomeChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: years_labels,
                    datasets: [{
                        label: 'Annual Income',
                        data: yearlyIncome,
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(41, 128, 185, 1)',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Income: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₹' + (value / 100000).toFixed(1) + 'L';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Cumulative Income Chart
            const ctx2 = document.getElementById('cumulativeChart').getContext('2d');
            cumulativeChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: years_labels,
                    datasets: [{
                        label: 'Cumulative Income',
                        data: cumulativeIncome,
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderColor: 'rgba(39, 174, 96, 1)',
                        borderWidth: 4,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: 'rgba(39, 174, 96, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Cumulative: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₹' + (value / 100000).toFixed(1) + 'L';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function createGrowthCharts(premiumData, policyData, years) {
            const years_labels = Array.from({length: years}, (_, i) => `Year ${i + 1}`);
            
            // Destroy existing charts
            if (premiumGrowthChart) premiumGrowthChart.destroy();
            if (policyGrowthChart) policyGrowthChart.destroy();
            
            // Premium Growth Chart
            const ctx1 = document.getElementById('premiumGrowthChart').getContext('2d');
            premiumGrowthChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: years_labels,
                    datasets: [{
                        label: 'Premium per Policy',
                        data: premiumData,
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: 'rgba(155, 89, 182, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Premium: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return '₹' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
            
            // Policy Growth Chart
            const ctx2 = document.getElementById('policyGrowthChart').getContext('2d');
            policyGrowthChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: years_labels,
                    datasets: [{
                        label: 'Policies Sold',
                        data: policyData,
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(41, 128, 185, 1)',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Policies: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }

        function createBreakdown() {
            let breakdownHTML = '';

            for (let i = 0; i < breakdownData.length; i++) {
                const data = breakdownData[i];
                
                breakdownHTML += `
                    <tr>
                        <td>${data.year}</td>
                        <td><strong>${data.policies.toLocaleString()}</strong></td>
                        <td><strong>${formatCurrency(data.premiumPerPolicy)}</strong></td>
                        <td><strong>${formatCurrency(data.totalPremium)}</strong></td>
                        <td><strong class="income-highlight">${formatCurrency(data.income)}</strong></td>
                        <td><strong>${formatCurrency(data.cumulativeIncome)}</strong></td>
                    </tr>
                `;
            }

            document.getElementById('breakdownBody').innerHTML = breakdownHTML;
        }
        
        function populateYearFilter(years) {
            const yearFilter = document.getElementById('yearFilter');
            yearFilter.innerHTML = '<option value="all">All Years</option>';
            
            for (let year = 1; year <= years; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `Year ${year}`;
                yearFilter.appendChild(option);
            }
        }
        
        function filterResults() {
            const yearFilter = document.getElementById('yearFilter').value;
            const incomeFilter = document.getElementById('incomeFilter').value;
            
            let filteredData = [...breakdownData];
            
            // Apply year filter
            if (yearFilter !== 'all') {
                const year = parseInt(yearFilter);
                filteredData = filteredData.filter(data => data.year === year);
            }
            
            // Apply income filter
            if (incomeFilter !== 'all') {
                if (incomeFilter === 'high') {
                    filteredData = filteredData.filter(data => data.income > 500000);
                } else if (incomeFilter === 'medium') {
                    filteredData = filteredData.filter(data => data.income >= 200000 && data.income <= 500000);
                } else if (incomeFilter === 'low') {
                    filteredData = filteredData.filter(data => data.income < 200000);
                }
            }
            
            // Update table
            let breakdownHTML = '';
            for (let i = 0; i < filteredData.length; i++) {
                const data = filteredData[i];
                
                breakdownHTML += `
                    <tr>
                        <td>${data.year}</td>
                        <td><strong>${data.policies.toLocaleString()}</strong></td>
                        <td><strong>${formatCurrency(data.premiumPerPolicy)}</strong></td>
                        <td><strong>${formatCurrency(data.totalPremium)}</strong></td>
                        <td><strong class="income-highlight">${formatCurrency(data.income)}</strong></td>
                        <td><strong>${formatCurrency(data.cumulativeIncome)}</strong></td>
                    </tr>
                `;
            }

            document.getElementById('breakdownBody').innerHTML = breakdownHTML;
        }
        
        function updateProfileReport(totalIncome, totalPolicies, yearlyIncome, photo, 
                                    peakPolicies, additionalPolicies, milestoneCount, 
                                    totalPremiumSum, milestones) {
            document.getElementById('reportAgentName').textContent = currentResults.agentName;
            document.getElementById('reportAgentId').textContent = currentResults.agentId;
            document.getElementById('reportAgentAge').textContent = currentResults.age;
            document.getElementById('reportAgentContact').textContent = currentResults.contact;
            document.getElementById('reportPeriod').textContent = `${currentResults.years} Years`;
            document.getElementById('reportInitialPremium').textContent = formatCurrency(currentResults.premium);
            document.getElementById('reportInitialPolicies').textContent = currentResults.lives;
            document.getElementById('reportTotalIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('reportAvgIncome').textContent = formatCurrency(totalIncome / currentResults.years);
            document.getElementById('reportPeakIncome').textContent = formatCurrency(Math.max(...yearlyIncome));
            document.getElementById('reportPremiumGrowth').innerHTML = `${(currentResults.premiumGrowth * 100).toFixed(1)}% <i class="fas fa-arrow-up growth-indicator"></i>`;
            document.getElementById('reportPolicyGrowth').innerHTML = `${(currentResults.policyGrowth * 100).toFixed(1)}% <i class="fas fa-arrow-up growth-indicator"></i>`;
            document.getElementById('reportPeakPolicies').textContent = peakPolicies.toLocaleString();
            document.getElementById('reportNextCrorePolicies').textContent = additionalPolicies.toLocaleString();
            document.getElementById('reportMilestoneCount').textContent = milestoneCount;
            document.getElementById('reportTotalPremium').textContent = formatCurrency(totalPremiumSum);
            
            // Update agent photo
            if (photo) {
                document.getElementById('agentPhotoImg').src = photo;
            }
            
            // Calculate income growth percentage
            if (yearlyIncome.length > 1) {
                const growth = ((yearlyIncome[yearlyIncome.length - 1] - yearlyIncome[0]) / yearlyIncome[0] * 100).toFixed(1);
                document.getElementById('incomeGrowth').innerHTML = `${growth}% <i class="fas fa-arrow-up growth-indicator"></i>`;
            }
            
            // Update milestone predictions
            updateMilestonePredictions(milestones);
        }
        
        function updateMilestonePredictions(milestones) {
            const milestoneGrid = document.getElementById('milestoneGrid');
            milestoneGrid.innerHTML = '';
            
            if (milestones.length === 0) {
                milestoneGrid.innerHTML = `
                    <div class="milestone-card">
                        <h4>No Milestones Achieved Yet</h4>
                        <div class="value">₹0</div>
                        <div class="subtitle">Your first crore milestone is within reach!</div>
                    </div>
                `;
                return;
            }
            
            milestones.forEach(milestone => {
                const croreValue = milestone.milestoneValue / 10000000;
                const milestoneCard = document.createElement('div');
                milestoneCard.className = 'milestone-card';
                
                milestoneCard.innerHTML = `
                    <div class="milestone-flag">Achieved!</div>
                    <h4>₹${croreValue} Crore Milestone</h4>
                    <div class="value">${formatCurrency(milestone.milestoneValue)}</div>
                    <div class="year">Achieved in Year ${milestone.year}</div>
                    <div class="detail">
                        <p><span class="highlight">${milestone.policies.toLocaleString()}</span> policies</p>
                        <p>Annual Premium: <span class="highlight">${formatCurrency(milestone.totalPremium)}</span></p>
                        <p>Annual Income: <span class="highlight">${formatCurrency(milestone.annualIncome)}</span></p>
                    </div>
                `;
                
                milestoneGrid.appendChild(milestoneCard);
            });
        }

        function saveAsPDF() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('profileReport');
            
            // Show loading
            const saveBtn = document.querySelector('.btn-success');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
            
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save(`Agent_Report_${currentResults.agentName || 'Agent'}.pdf`);
                saveBtn.innerHTML = originalText;
            });
        }

        function saveAsImage() {
            const element = document.getElementById('profileReport');
            
            // Show loading
            const saveBtn = document.querySelector('.btn-warning');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving Image...';
            
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Agent_Report_${currentResults.agentName || 'Agent'}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                saveBtn.innerHTML = originalText;
            });
        }

        function resetForm() {
            document.getElementById('agentName').value = '';
            document.getElementById('age').value = '';
            document.getElementById('contact').value = '';
            document.getElementById('agentId').value = '';
            document.getElementById('premium').value = '';
            document.getElementById('lives').value = '';
            document.getElementById('years').value = '';
            document.getElementById('premiumGrowth').value = '10';
            document.getElementById('policyGrowth').value = '10';
            
            // Reset photo preview
            document.getElementById('photoPreview').innerHTML = '<i class="fas fa-user-plus"></i>';
            agentPhoto = null;
            
            document.getElementById('results').style.display = 'none';
        }

        // Initialize with sample data
        window.onload = function() {
            calculateIncome();
        };
    </script>
</body>
</html> 
